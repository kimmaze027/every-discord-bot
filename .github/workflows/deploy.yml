name: Deploy to Aorus

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Tailscale
        uses: tailscale/github-action@v3
        with:
          authkey: ${{ secrets.TAILSCALE_AUTHKEY }}

      - name: Deploy via Tailscale SSH
        env:
          DEPLOY_USER: ${{ secrets.DEPLOY_USER }}
        run: |
          tailscale ssh "$DEPLOY_USER@aorus" "cd ~/every-discord-bot && git pull origin main && docker compose up --build -d"
